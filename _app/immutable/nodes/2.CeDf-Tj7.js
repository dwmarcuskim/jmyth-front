import{t as L,a as H}from"../chunks/disclose-version.-8ibBl-a.js";import{i as ce}from"../chunks/legacy.ZyCjkF0e.js";import{L as ue,v as de,S as ve,Z as ne,x as oe,a3 as he,a4 as ge,m as pe,a5 as W,a6 as _e,z as A,a7 as me,a8 as F,w as ie,a9 as xe,a2 as be,aa as ye,M as we,K as X,P as Ee,y as ke,C as V,I as Te,A as Ie,H as Ae,B as Z,D as K,F as z,$ as Me,W as Se,ab as Ne,ac as De,ad as Q,ae as Oe,af as Ce,ag as He,s as S,f as ee,c as N,t as P,r as M,p as Le,d as g,ah as R,g as x,ai as Re,aj as $e,a as ze}from"../chunks/runtime.CfWXK4fg.js";import{a as Fe,l as Pe,s as U,h as Ye,e as re}from"../chunks/render.Yls9UIfI.js";import{i as q,o as je}from"../chunks/index-client.CG1KUufb.js";import{a as Be}from"../chunks/attributes.CaPm3nup.js";function Ge(r,e,a,n){for(var t=[],s=e.length,o=0;o<s;o++)xe(e[o].e,t,!0);var i=s>0&&t.length===0&&a!==null;if(i){var u=a.parentNode;be(u),u.append(a),n.clear(),O(r,e[0].prev,e[s-1].next)}ye(t,()=>{for(var h=0;h<s;h++){var l=e[h];i||(n.delete(l.k),O(r,l.prev,l.next)),we(l.e,!i)}})}function Ve(r,e,a,n,t,s=null){var o=r,i={items:new Map,first:null};{var u=r;o=A?V(Te(u)):u.appendChild(ue())}A&&Ie();var h=null,l=!1;de(()=>{var _=a(),d=ve(_)?_:_==null?[]:ne(_),c=d.length;if(l&&c===0)return;l=c===0;let b=!1;if(A){var I=o.data===Ae;I!==(c===0)&&(o=Z(),V(o),K(!1),b=!0)}if(A){for(var E=null,v,m=0;m<c;m++){if(z.nodeType===8&&z.data===Me){o=z,b=!0,K(!1);break}var D=d[m],y=n(D,m);v=fe(z,i,E,null,D,y,m,t,e),i.items.set(y,v),E=v}c>0&&V(Z())}if(!A){var w=Ee;Ke(d,i,o,t,e,(w.f&F)!==0,n)}s!==null&&(c===0?h?ie(h):h=oe(()=>s(o)):h!==null&&ke(h,()=>{h=null})),b&&K(!0),a()}),A&&(o=z)}function Ke(r,e,a,n,t,s,o){var i=r.length,u=e.items,h=e.first,l=h,_,d=null,c=[],b=[],I,E,v,m;for(m=0;m<i;m+=1){if(I=r[m],E=o(I,m),v=u.get(E),v===void 0){var D=l?l.e.nodes_start:a;d=fe(D,e,d,d===null?e.first:d.next,I,E,m,n,t),u.set(E,d),c=[],b=[],l=d.next;continue}if(Ue(v,I,m),v.e.f&F&&ie(v.e),v!==l){if(_!==void 0&&_.has(v)){if(c.length<b.length){var y=b[0],w;d=y.prev;var $=c[0],f=c[c.length-1];for(w=0;w<c.length;w+=1)ae(c[w],y,a);for(w=0;w<b.length;w+=1)_.delete(b[w]);O(e,$.prev,f.next),O(e,d,$),O(e,f,y),l=y,d=f,m-=1,c=[],b=[]}else _.delete(v),ae(v,l,a),O(e,v.prev,v.next),O(e,v,d===null?e.first:d.next),O(e,d,v),d=v;continue}for(c=[],b=[];l!==null&&l.k!==E;)(s||!(l.e.f&F))&&(_??(_=new Set)).add(l),b.push(l),l=l.next;if(l===null)continue;v=l}c.push(v),d=v,l=v.next}if(l!==null||_!==void 0){for(var p=_===void 0?[]:ne(_);l!==null;)(s||!(l.e.f&F))&&p.push(l),l=l.next;var k=p.length;if(k>0){var T=i===0?a:null;Ge(e,p,T,u)}}X.first=e.first&&e.first.e,X.last=d&&d.e}function Ue(r,e,a,n){me(r.v,e),r.i=a}function fe(r,e,a,n,t,s,o,i,u){var h=(u&he)!==0,l=(u&ge)===0,_=h?l?pe(t):W(t):t,d=u&_e?W(o):o,c={i:d,v:_,k:s,a:null,e:null,prev:a,next:n};try{return c.e=oe(()=>i(r,_,d),A),c.e.prev=a&&a.e,c.e.next=n&&n.e,a===null?e.first=c:(a.next=c,a.e.next=c.e),n!==null&&(n.prev=c,n.e.prev=c.e),c}finally{}}function ae(r,e,a){for(var n=r.next?r.next.e.nodes_start:a,t=e?e.e.nodes_start:a,s=r.e.nodes_start;s!==n;){var o=Se(s);t.before(s),s=o}}function O(r,e,a){e===null?r.first=a:(e.next=a,e.e.next=a&&a.e),a!==null&&(a.prev=e,a.e.prev=e&&e.e)}function qe(r){if(A){var e=!1,a=()=>{if(!e){if(e=!0,r.hasAttribute("value")){var n=r.value;J(r,"value",null),r.value=n}if(r.hasAttribute("checked")){var t=r.checked;J(r,"checked",null),r.checked=t}}};r.__on_r=a,Ne(a),Fe()}}function J(r,e,a,n){var t=r.__attributes??(r.__attributes={});A&&(t[e]=r.getAttribute(e),e==="src"||e==="srcset"||e==="href"&&r.nodeName==="LINK")||t[e]!==(t[e]=a)&&(e==="style"&&"__styles"in r&&(r.__styles={}),e==="loading"&&(r[De]=a),a==null?r.removeAttribute(e):typeof a!="string"&&Je(r).includes(e)?r[e]=a:r.setAttribute(e,a))}var te=new Map;function Je(r){var e=te.get(r.nodeName);if(e)return e;te.set(r.nodeName,e=[]);for(var a,n=Q(r),t=Element.prototype;t!==n;){a=Oe(n);for(var s in a)a[s].set&&e.push(s);n=Q(n)}return e}function We(r,e,a=e){var n=Ce();Pe(r,"input",()=>{var t=se(r)?le(r.value):r.value;a(t),n&&t!==(t=e())&&(r.value=t??"")}),He(()=>{var t=e();if(A&&r.defaultValue!==r.value){a(r.value);return}se(r)&&t===le(r.value)||r.type==="date"&&!t&&!r.value||t!==r.value&&(r.value=t??"")})}function se(r){var e=r.type;return e==="number"||e==="range"}function le(r){return r===""?null:+r}const Xe=!0,Ze="always",hr=Object.freeze(Object.defineProperty({__proto__:null,prerender:Xe,trailingSlash:Ze},Symbol.toStringTag,{value:"Module"})),Qe=""+new URL("../assets/ohneuri_profile.DNuywFYS.jpg",import.meta.url).href;var er=L('<span class="w-full text-right flex-grow"></span> <div class="flex flex-col flex-shrink-0 bg-white px-4 py-2 rounded-lg max-w-70p svelte-1jahw2t"><p class="text-right font-bold">사용자</p> <p class="text-left pr-2"> </p></div>',1),rr=L(`<img class="w-12 h-12 rounded-full mr-2" id="bot-img"${Be("src",Qe)} alt="bot profile"> <div class="relative ml-1 w-full max-w-80p svelte-1jahw2t"><div class="absolute top-6 right-full transform -translate-y-1/2 w-0 h-0
                    border-t-[8px] border-b-[8px] border-r-[8px] border-transparent
                    border-r-blue-200"></div> <div class="flex flex-col flex-grow bg-blue-200 px-4 py-2 rounded-lg w-full"><p class="text-left font-bold">오늘이</p> <p class="text-left pl-2"> </p></div></div>`,1),ar=L('<div class="w-full flex nanum-gothic-regular pb-2 svelte-1jahw2t"><!></div>');function tr(r,e){var a=ar(),n=N(a);q(n,()=>e.role==="user",t=>{var s=er(),o=S(ee(s),2),i=S(N(o),2),u=N(i,!0);M(i),M(o),P(()=>U(u,e.message)),H(t,s)},t=>{var s=rr(),o=S(ee(s),2),i=S(N(o),2),u=S(N(i),2),h=N(u,!0);M(u),M(i),M(o),P(()=>U(h,e.message)),H(t,s)}),M(a),H(r,a)}var sr=L('<meta name="description" content="Svelte demo app"> <link rel="preconnect" href="https://fonts.googleapis.com"> <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin=""> <link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic&amp;display=swap" rel="stylesheet">',1),lr=L('<p class="text-center text-2xl font-bold mb-4 bg-blue-400 rounded-xl p-2">아무 말이나 입력해서<br>오늘이와 대화를 시작해 보세요!</p>'),nr=L('<p class="text-center text-2xl font-bold mb-4 bg-blue-400 rounded-xl p-2"> </p>'),or=L('<section class="w-full flex flex-col align-top justify-center p-8"><!> <!> <div id="messages-container"></div> <form class="flex"><input class="flex-grow"> <button class="flex-shrink-0 rounded-lg p-2 ml-2 bg-blue-400" type="submit">보내기</button> <button class="flex-shrink-0 rounded-lg p-2 ml-2 bg-red-400">대화 초기화</button></form></section>');function gr(r,e){Le(e,!1);let a=R("");const n="오늘이에게 보낼 메시지를 입력해 보세요.";let t=R(!1),s=R(!1),o=R(),i,u=R(!1),h=R([]);je(()=>{i=localStorage.getItem("threadId"),i==null?g(t,!0):(g(o,"이전 대화 내용을 불러오는 중..."),g(s,!0),l(i)),console.log(i),console.log(x(h))});async function l(f){g(u,!0);try{const T=await fetch(`http://localhost:8080/assistant/thread/${f}/message`,{method:"GET"});T.ok||alert("메시지 불러오기에 실패했습니다. 나중에 다시 시도해 주세요.");const C=await T.json();console.log(C);for(var p=[],k=0;k<C.length;(k+=1)-1){const{content:Y,role:j}=C[k],{text:B}=Y[0],{value:G}=B;p.push({message:G,role:j})}g(h,p.reverse())}catch(T){console.error("Error getting all messages:",T),alert("메시지 불러오기에 실패했습니다. 나중에 다시 시도해 주세요.")}finally{g(u,!1),g(s,!1)}}async function _(){if(x(a)!=="")try{if(g(t,!1),g(u,!0),g(o,"메시지 전송 중..."),g(s,!0),i==null&&!await d()){alert("대화 생성에 실패했습니다. 나중에 다시 시도해 주세요.");return}var f=await c(x(a));if(f==null){alert("메시지 전송에 실패했습니다. 나중에 다시 시도해 주세요.");return}g(h,[...x(h),{message:x(a),role:"user"},...f.reverse()]),g(a,"")}catch(p){console.error("Error sending message:",p)}finally{g(u,!1),g(s,!1)}}async function d(){try{const f=await fetch("http://localhost:8080/assistant/thread",{method:"POST"});return f.ok?(i=await f.text(),localStorage.setItem("threadId",i),!0):(console.error("Failed to initialize thread"),!1)}catch(f){return console.error("Error initializing thread:",f),!1}}async function c(f){try{const T=await fetch(`http://localhost:8080/assistant/thread/${i}/message`,{method:"POST",headers:{"Content-Type":"plain/text"},body:f});if(!T.ok)return console.error("Failed to get next message"),null;const C=await T.json();console.log(C);for(var p=[],k=0;k<C.length;(k+=1)-1){const{content:Y,role:j}=C[k],{text:B}=Y[0],{value:G}=B;p.push({message:G,role:j})}return p}catch(T){return console.error("Error getting next message:",T),null}}async function b(){if(i!=null&&confirm("정말 대화를 초기화하시겠습니까?"))try{if(g(u,!0),g(o,"대화 초기화 중..."),g(s,!0),!(await fetch(`http://localhost:8080/assistant/thread/${i}`,{method:"DELETE"})).ok){console.error("Failed to delete thread"),alert("대화 초기화에 실패했습니다. 나중에 다시 시도해 주세요.");return}localStorage.removeItem("threadId"),i=null,g(t,!0),g(h,[])}catch(f){console.error("Error deleting thread:",f)}finally{g(u,!1),g(s,!1)}}ce();var I=or();Ye(f=>{var p=sr();Re.title="Home",$e(6),H(f,p)});var E=N(I);q(E,()=>x(t),f=>{var p=lr();H(f,p)});var v=S(E,2);q(v,()=>x(s),f=>{var p=nr(),k=N(p,!0);M(p),P(()=>U(k,x(o))),H(f,p)});var m=S(v,2);Ve(m,5,()=>x(h),f=>f,(f,p)=>{tr(f,{get message(){return x(p).message},get role(){return x(p).role}})}),M(m);var D=S(m,2),y=N(D);qe(y),J(y,"placeholder",n);var w=S(y,2),$=S(w,2);M(D),M(I),P(()=>{y.disabled=x(u),w.disabled=x(u),$.disabled=x(u)}),We(y,()=>x(a),f=>g(a,f)),re("click",$,b),re("submit",D,_),H(r,I),ze()}export{gr as component,hr as universal};
