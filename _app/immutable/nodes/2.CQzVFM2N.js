import{t as O,b as D}from"../chunks/disclose-version.77trNYxH.js";import{i as fe}from"../chunks/legacy.XyEEezU5.js";import{U as ue,z as ce,T as de,$ as se,B as le,a7 as ve,a8 as ge,m as pe,a9 as q,aa as he,h as C,ab as me,ac as F,A as ne,ad as _e,a4 as be,ae as xe,M as ye,Q as K,P as we,C as Ee,G as J,Y as Te,D as ke,H as Ie,F as W,I as U,J as j,a1 as Me,X as Se,af as Ae,ag as $e,f as Z,s as I,c as S,t as G,r as k,p as Ce,e as p,ah as z,i as x,ai as He,aj as Ne,b as De}from"../chunks/runtime.vrpVNPhL.js";import{l as Oe,s as X,h as Re,e as ee}from"../chunks/render.BTAftfeZ.js";import{i as Q,o as ze}from"../chunks/index-client.DrClod2q.js";import{s as oe,r as Pe}from"../chunks/attributes.DN5SeWWp.js";import{b as je}from"../chunks/paths.C8SA0jlG.js";function Fe(r,e,a,c){for(var l=[],u=e.length,s=0;s<u;s++)_e(e[s].e,l,!0);var g=u>0&&l.length===0&&a!==null;if(g){var n=a.parentNode;be(n),n.append(a),c.clear(),H(r,e[0].prev,e[u-1].next)}xe(l,()=>{for(var i=0;i<u;i++){var t=e[i];g||(c.delete(t.k),H(r,t.prev,t.next)),ye(t.e,!g)}})}function Ge(r,e,a,c,l,u=null){var s=r,g={items:new Map,first:null};{var n=r;s=C?J(Te(n)):n.appendChild(ue())}C&&ke();var i=null,t=!1;ce(()=>{var h=a(),d=de(h)?h:h==null?[]:se(h),f=d.length;if(t&&f===0)return;t=f===0;let y=!1;if(C){var A=s.data===Ie;A!==(f===0)&&(s=W(),J(s),U(!1),y=!0)}if(C){for(var w=null,v,_=0;_<f;_++){if(j.nodeType===8&&j.data===Me){s=j,y=!0,U(!1);break}var $=d[_],E=c($,_);v=ie(j,g,w,null,$,E,_,l,e),g.items.set(E,v),w=v}f>0&&J(W())}if(!C){var b=we;Le(d,g,s,l,e,(b.f&F)!==0,c)}u!==null&&(f===0?i?ne(i):i=le(()=>u(s)):i!==null&&Ee(i,()=>{i=null})),y&&U(!0),a()}),C&&(s=j)}function Le(r,e,a,c,l,u,s){var g=r.length,n=e.items,i=e.first,t=i,h,d=null,f=[],y=[],A,w,v,_;for(_=0;_<g;_+=1){if(A=r[_],w=s(A,_),v=n.get(w),v===void 0){var $=t?t.e.nodes_start:a;d=ie($,e,d,d===null?e.first:d.next,A,w,_,c,l),n.set(w,d),f=[],y=[],t=d.next;continue}if(Ve(v,A,_),v.e.f&F&&ne(v.e),v!==t){if(h!==void 0&&h.has(v)){if(f.length<y.length){var E=y[0],b;d=E.prev;var P=f[0],R=f[f.length-1];for(b=0;b<f.length;b+=1)re(f[b],E,a);for(b=0;b<y.length;b+=1)h.delete(y[b]);H(e,P.prev,R.next),H(e,d,P),H(e,R,E),t=E,d=R,_-=1,f=[],y=[]}else h.delete(v),re(v,t,a),H(e,v.prev,v.next),H(e,v,d===null?e.first:d.next),H(e,d,v),d=v;continue}for(f=[],y=[];t!==null&&t.k!==w;)(u||!(t.e.f&F))&&(h??(h=new Set)).add(t),y.push(t),t=t.next;if(t===null)continue;v=t}f.push(v),d=v,t=v.next}if(t!==null||h!==void 0){for(var o=h===void 0?[]:se(h);t!==null;)(u||!(t.e.f&F))&&o.push(t),t=t.next;var m=o.length;if(m>0){var T=g===0?a:null;Fe(e,o,T,n)}}K.first=e.first&&e.first.e,K.last=d&&d.e}function Ve(r,e,a,c){me(r.v,e),r.i=a}function ie(r,e,a,c,l,u,s,g,n){var i=(n&ve)!==0,t=(n&ge)===0,h=i?t?pe(l):q(l):l,d=n&he?q(s):s,f={i:d,v:h,k:u,a:null,e:null,prev:a,next:c};try{return f.e=le(()=>g(r,h,d),C),f.e.prev=a&&a.e,f.e.next=c&&c.e,a===null?e.first=f:(a.next=f,a.e.next=f.e),c!==null&&(c.prev=f,c.e.prev=f.e),f}finally{}}function re(r,e,a){for(var c=r.next?r.next.e.nodes_start:a,l=e?e.e.nodes_start:a,u=r.e.nodes_start;u!==c;){var s=Se(u);l.before(u),u=s}}function H(r,e,a){e===null?r.first=a:(e.next=a,e.e.next=a&&a.e),a!==null&&(a.prev=e,a.e.prev=e&&e.e)}function Ye(r,e,a=e){var c=Ae();Oe(r,"input",()=>{var l=ae(r)?te(r.value):r.value;a(l),c&&l!==(l=e())&&(r.value=l??"")}),$e(()=>{var l=e();if(C&&r.defaultValue!==r.value){a(r.value);return}ae(r)&&l===te(r.value)||r.type==="date"&&!l&&!r.value||l!==r.value&&(r.value=l??"")})}function ae(r){var e=r.type;return e==="number"||e==="range"}function te(r){return r===""?null:+r}const Be=!0,Je="always",ir=Object.freeze(Object.defineProperty({__proto__:null,prerender:Be,trailingSlash:Je},Symbol.toStringTag,{value:"Module"}));var Ue=O('<span class="w-full text-right flex-grow"></span> <div class="flex flex-col flex-shrink-0 bg-white px-4 py-2 rounded-lg max-w-70p svelte-1jahw2t"><p class="text-right font-bold">사용자</p> <p class="text-left pr-2"> </p></div>',1),Xe=O(`<img class="w-12 h-12 rounded-full mr-2" id="bot-img" alt="bot profile"> <div class="relative ml-1 w-full max-w-80p svelte-1jahw2t"><div class="absolute top-6 right-full transform -translate-y-1/2 w-0 h-0
                    border-t-[8px] border-b-[8px] border-r-[8px] border-transparent
                    border-r-blue-200"></div> <div class="flex flex-col flex-grow bg-blue-200 px-4 py-2 rounded-lg w-full"><p class="text-left font-bold">오늘이</p> <p class="text-left pl-2"> </p></div></div>`,1),Qe=O('<div class="w-full flex nanum-gothic-regular pb-2 svelte-1jahw2t"><!></div>');function qe(r,e){const a=`${je}/images/ohneuri_profile.jpg`;var c=Qe(),l=S(c);Q(l,()=>e.role==="user",u=>{var s=Ue(),g=I(Z(s),2),n=I(S(g),2),i=S(n,!0);k(n),k(g),G(()=>X(i,e.message)),D(u,s)},u=>{var s=Xe(),g=Z(s);oe(g,"src",a);var n=I(g,2),i=I(S(n),2),t=I(S(i),2),h=S(t,!0);k(t),k(i),k(n),G(()=>X(h,e.message)),D(u,s)}),k(c),D(r,c)}var Ke=O('<meta name="description" content="Svelte demo app"> <link rel="preconnect" href="https://fonts.googleapis.com"> <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin=""> <link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic&amp;display=swap" rel="stylesheet">',1),We=O('<p class="text-center text-2xl font-bold mb-4 bg-blue-400 rounded-xl p-2">아무 말이나 입력해서<br>오늘이와 대화를 시작해 보세요!</p>'),Ze=O('<p class="text-center text-2xl font-bold mb-4 bg-blue-400 rounded-xl p-2"> </p>'),er=O('<section class="w-full flex flex-col align-top justify-center p-8"><!> <!> <div id="messages-container"></div> <form class="flex"><input class="flex-grow"> <button class="flex-shrink-0 rounded-lg p-2 ml-2 bg-blue-400" type="submit">보내기</button> <button class="flex-shrink-0 rounded-lg p-2 ml-2 bg-red-400">대화 초기화</button></form></section>');function fr(r,e){Ce(e,!1);let a=z("");const c="오늘이에게 보낼 메시지를 입력해 보세요.",l="https://jmyth-176667264008.us-central1.run.app";let u=z(!1),s=z(!1),g=z(),n,i=z(!1),t=z([]);ze(()=>{n=localStorage.getItem("threadId"),n==null?p(u,!0):(p(g,"이전 대화 내용을 불러오는 중..."),p(s,!0),h(n)),console.log(n),console.log(x(t))});async function h(o){p(i,!0);try{const M=await fetch(`${l}/assistant/thread/${o}/message`,{method:"GET"});M.ok||alert("메시지 불러오기에 실패했습니다. 나중에 다시 시도해 주세요.");const N=await M.json();console.log(N);for(var m=[],T=0;T<N.length;(T+=1)-1){const{content:L,role:V}=N[T],{text:Y}=L[0],{value:B}=Y;m.push({message:B,role:V})}p(t,m.reverse())}catch(M){console.error("Error getting all messages:",M),alert("메시지 불러오기에 실패했습니다. 나중에 다시 시도해 주세요.")}finally{p(i,!1),p(s,!1)}}async function d(){if(x(a)!=="")try{if(p(u,!1),p(i,!0),p(g,"메시지 전송 중..."),p(s,!0),n==null&&!await f()){alert("대화 생성에 실패했습니다. 나중에 다시 시도해 주세요.");return}var o=await y(x(a));if(o==null){alert("메시지 전송에 실패했습니다. 나중에 다시 시도해 주세요.");return}p(t,[...x(t),{message:x(a),role:"user"},...o.reverse()]),p(a,"")}catch(m){console.error("Error sending message:",m)}finally{p(i,!1),p(s,!1)}}async function f(){try{const o=await fetch(`${l}/assistant/thread`,{method:"POST"});return o.ok?(n=await o.text(),localStorage.setItem("threadId",n),!0):(console.error("Failed to initialize thread"),!1)}catch(o){return console.error("Error initializing thread:",o),!1}}async function y(o){try{const M=await fetch(`${l}/assistant/thread/${n}/message`,{method:"POST",headers:{"Content-Type":"plain/text"},body:o});if(!M.ok)return console.error("Failed to get next message"),null;const N=await M.json();console.log(N);for(var m=[],T=0;T<N.length;(T+=1)-1){const{content:L,role:V}=N[T],{text:Y}=L[0],{value:B}=Y;m.push({message:B,role:V})}return m}catch(M){return console.error("Error getting next message:",M),null}}async function A(){if(n!=null&&confirm("정말 대화를 초기화하시겠습니까?"))try{if(p(i,!0),p(g,"대화 초기화 중..."),p(s,!0),!(await fetch(`${l}/assistant/thread/${n}`,{method:"DELETE"})).ok){console.error("Failed to delete thread"),alert("대화 초기화에 실패했습니다. 나중에 다시 시도해 주세요.");return}localStorage.removeItem("threadId"),n=null,p(u,!0),p(t,[])}catch(o){console.error("Error deleting thread:",o)}finally{p(i,!1),p(s,!1)}}fe();var w=er();Re(o=>{var m=Ke();He.title="Home",Ne(6),D(o,m)});var v=S(w);Q(v,()=>x(u),o=>{var m=We();D(o,m)});var _=I(v,2);Q(_,()=>x(s),o=>{var m=Ze(),T=S(m,!0);k(m),G(()=>X(T,x(g))),D(o,m)});var $=I(_,2);Ge($,5,()=>x(t),o=>o,(o,m)=>{qe(o,{get message(){return x(m).message},get role(){return x(m).role}})}),k($);var E=I($,2),b=S(E);Pe(b),oe(b,"placeholder",c);var P=I(b,2),R=I(P,2);k(E),k(w),G(()=>{b.disabled=x(i),P.disabled=x(i),R.disabled=x(i)}),Ye(b,()=>x(a),o=>p(a,o)),ee("click",R,A),ee("submit",E,d),D(r,w),De()}export{fr as component,ir as universal};
