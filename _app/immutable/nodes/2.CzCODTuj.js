import{t as R,b as O}from"../chunks/disclose-version.77trNYxH.js";import{i as ie}from"../chunks/legacy.XyEEezU5.js";import{U as fe,z as ue,T as ce,$ as te,B as le,a7 as de,a8 as ve,m as he,a9 as Q,aa as ge,h as H,ab as pe,ac as F,A as se,ad as me,a4 as _e,ae as be,M as xe,Q as q,P as ye,C as we,G as B,Y as Ee,D as Te,H as ke,F as K,I as J,J as P,a1 as Ie,X as Me,af as Se,ag as Ae,f as W,s as S,c as A,t as j,r as M,p as Ce,e as g,ah as $,i as b,ai as He,aj as Ne,b as De}from"../chunks/runtime.vrpVNPhL.js";import{l as Oe,s as U,h as Re,e as Z}from"../chunks/render.BTAftfeZ.js";import{i as X,o as $e}from"../chunks/index-client.DrClod2q.js";import{s as ne,r as ze}from"../chunks/attributes.DN5SeWWp.js";import{b as Pe}from"../chunks/paths.CvabalTe.js";function Fe(r,e,a,d){for(var l=[],i=e.length,s=0;s<i;s++)me(e[s].e,l,!0);var n=i>0&&l.length===0&&a!==null;if(n){var f=a.parentNode;_e(f),f.append(a),d.clear(),N(r,e[0].prev,e[i-1].next)}be(l,()=>{for(var c=0;c<i;c++){var t=e[c];n||(d.delete(t.k),N(r,t.prev,t.next)),xe(t.e,!n)}})}function je(r,e,a,d,l,i=null){var s=r,n={items:new Map,first:null};{var f=r;s=H?B(Ee(f)):f.appendChild(fe())}H&&Te();var c=null,t=!1;ue(()=>{var m=a(),v=ce(m)?m:m==null?[]:te(m),u=v.length;if(t&&u===0)return;t=u===0;let x=!1;if(H){var I=s.data===ke;I!==(u===0)&&(s=K(),B(s),J(!1),x=!0)}if(H){for(var E=null,h,_=0;_<u;_++){if(P.nodeType===8&&P.data===Ie){s=P,x=!0,J(!1);break}var C=v[_],y=d(C,_);h=oe(P,n,E,null,C,y,_,l,e),n.items.set(y,h),E=h}u>0&&B(K())}if(!H){var w=ye;Ge(v,n,s,l,e,(w.f&F)!==0,d)}i!==null&&(u===0?c?se(c):c=le(()=>i(s)):c!==null&&we(c,()=>{c=null})),x&&J(!0),a()}),H&&(s=P)}function Ge(r,e,a,d,l,i,s){var n=r.length,f=e.items,c=e.first,t=c,m,v=null,u=[],x=[],I,E,h,_;for(_=0;_<n;_+=1){if(I=r[_],E=s(I,_),h=f.get(E),h===void 0){var C=t?t.e.nodes_start:a;v=oe(C,e,v,v===null?e.first:v.next,I,E,_,d,l),f.set(E,v),u=[],x=[],t=v.next;continue}if(Le(h,I,_),h.e.f&F&&se(h.e),h!==t){if(m!==void 0&&m.has(h)){if(u.length<x.length){var y=x[0],w;v=y.prev;var z=u[0],o=u[u.length-1];for(w=0;w<u.length;w+=1)ee(u[w],y,a);for(w=0;w<x.length;w+=1)m.delete(x[w]);N(e,z.prev,o.next),N(e,v,z),N(e,o,y),t=y,v=o,_-=1,u=[],x=[]}else m.delete(h),ee(h,t,a),N(e,h.prev,h.next),N(e,h,v===null?e.first:v.next),N(e,v,h),v=h;continue}for(u=[],x=[];t!==null&&t.k!==E;)(i||!(t.e.f&F))&&(m??(m=new Set)).add(t),x.push(t),t=t.next;if(t===null)continue;h=t}u.push(h),v=h,t=h.next}if(t!==null||m!==void 0){for(var p=m===void 0?[]:te(m);t!==null;)(i||!(t.e.f&F))&&p.push(t),t=t.next;var T=p.length;if(T>0){var k=n===0?a:null;Fe(e,p,k,f)}}q.first=e.first&&e.first.e,q.last=v&&v.e}function Le(r,e,a,d){pe(r.v,e),r.i=a}function oe(r,e,a,d,l,i,s,n,f){var c=(f&de)!==0,t=(f&ve)===0,m=c?t?he(l):Q(l):l,v=f&ge?Q(s):s,u={i:v,v:m,k:i,a:null,e:null,prev:a,next:d};try{return u.e=le(()=>n(r,m,v),H),u.e.prev=a&&a.e,u.e.next=d&&d.e,a===null?e.first=u:(a.next=u,a.e.next=u.e),d!==null&&(d.prev=u,d.e.prev=u.e),u}finally{}}function ee(r,e,a){for(var d=r.next?r.next.e.nodes_start:a,l=e?e.e.nodes_start:a,i=r.e.nodes_start;i!==d;){var s=Me(i);l.before(i),i=s}}function N(r,e,a){e===null?r.first=a:(e.next=a,e.e.next=a&&a.e),a!==null&&(a.prev=e,a.e.prev=e&&e.e)}function Ve(r,e,a=e){var d=Se();Oe(r,"input",()=>{var l=re(r)?ae(r.value):r.value;a(l),d&&l!==(l=e())&&(r.value=l??"")}),Ae(()=>{var l=e();if(H&&r.defaultValue!==r.value){a(r.value);return}re(r)&&l===ae(r.value)||r.type==="date"&&!l&&!r.value||l!==r.value&&(r.value=l??"")})}function re(r){var e=r.type;return e==="number"||e==="range"}function ae(r){return r===""?null:+r}const Ye=!0,Be="always",or=Object.freeze(Object.defineProperty({__proto__:null,prerender:Ye,trailingSlash:Be},Symbol.toStringTag,{value:"Module"}));var Je=R('<span class="w-full text-right flex-grow"></span> <div class="flex flex-col flex-shrink-0 bg-white px-4 py-2 rounded-lg max-w-70p svelte-1jahw2t"><p class="text-right font-bold">사용자</p> <p class="text-left pr-2"> </p></div>',1),Ue=R(`<img class="w-12 h-12 rounded-full mr-2" id="bot-img" alt="bot profile"> <div class="relative ml-1 w-full max-w-80p svelte-1jahw2t"><div class="absolute top-6 right-full transform -translate-y-1/2 w-0 h-0
                    border-t-[8px] border-b-[8px] border-r-[8px] border-transparent
                    border-r-blue-200"></div> <div class="flex flex-col flex-grow bg-blue-200 px-4 py-2 rounded-lg w-full"><p class="text-left font-bold">오늘이</p> <p class="text-left pl-2"> </p></div></div>`,1),Xe=R('<div class="w-full flex nanum-gothic-regular pb-2 svelte-1jahw2t"><!></div>');function Qe(r,e){const a=`${Pe}/images/ohneuri_profile.jpg`;var d=Xe(),l=A(d);X(l,()=>e.role==="user",i=>{var s=Je(),n=S(W(s),2),f=S(A(n),2),c=A(f,!0);M(f),M(n),j(()=>U(c,e.message)),O(i,s)},i=>{var s=Ue(),n=W(s);ne(n,"src",a);var f=S(n,2),c=S(A(f),2),t=S(A(c),2),m=A(t,!0);M(t),M(c),M(f),j(()=>U(m,e.message)),O(i,s)}),M(d),O(r,d)}var qe=R('<meta name="description" content="Svelte demo app"> <link rel="preconnect" href="https://fonts.googleapis.com"> <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin=""> <link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic&amp;display=swap" rel="stylesheet">',1),Ke=R('<p class="text-center text-2xl font-bold mb-4 bg-blue-400 rounded-xl p-2">아무 말이나 입력해서<br>오늘이와 대화를 시작해 보세요!</p>'),We=R('<p class="text-center text-2xl font-bold mb-4 bg-blue-400 rounded-xl p-2"> </p>'),Ze=R('<section class="w-full flex flex-col align-top justify-center p-8"><!> <!> <div id="messages-container"></div> <form class="flex"><input class="flex-grow"> <button class="flex-shrink-0 rounded-lg p-2 ml-2 bg-blue-400" type="submit">보내기</button> <button class="flex-shrink-0 rounded-lg p-2 ml-2 bg-red-400">대화 초기화</button></form></section>');function ir(r,e){Ce(e,!1);let a=$("");const d="오늘이에게 보낼 메시지를 입력해 보세요.";let l=$(!1),i=$(!1),s=$(),n,f=$(!1),c=$([]);$e(()=>{n=localStorage.getItem("threadId"),n==null?g(l,!0):(g(s,"이전 대화 내용을 불러오는 중..."),g(i,!0),t(n)),console.log(n),console.log(b(c))});async function t(o){g(f,!0);try{const k=await fetch(`http://localhost:8080/assistant/thread/${o}/message`,{method:"GET"});k.ok||alert("메시지 불러오기에 실패했습니다. 나중에 다시 시도해 주세요.");const D=await k.json();console.log(D);for(var p=[],T=0;T<D.length;(T+=1)-1){const{content:G,role:L}=D[T],{text:V}=G[0],{value:Y}=V;p.push({message:Y,role:L})}g(c,p.reverse())}catch(k){console.error("Error getting all messages:",k),alert("메시지 불러오기에 실패했습니다. 나중에 다시 시도해 주세요.")}finally{g(f,!1),g(i,!1)}}async function m(){if(b(a)!=="")try{if(g(l,!1),g(f,!0),g(s,"메시지 전송 중..."),g(i,!0),n==null&&!await v()){alert("대화 생성에 실패했습니다. 나중에 다시 시도해 주세요.");return}var o=await u(b(a));if(o==null){alert("메시지 전송에 실패했습니다. 나중에 다시 시도해 주세요.");return}g(c,[...b(c),{message:b(a),role:"user"},...o.reverse()]),g(a,"")}catch(p){console.error("Error sending message:",p)}finally{g(f,!1),g(i,!1)}}async function v(){try{const o=await fetch("http://localhost:8080/assistant/thread",{method:"POST"});return o.ok?(n=await o.text(),localStorage.setItem("threadId",n),!0):(console.error("Failed to initialize thread"),!1)}catch(o){return console.error("Error initializing thread:",o),!1}}async function u(o){try{const k=await fetch(`http://localhost:8080/assistant/thread/${n}/message`,{method:"POST",headers:{"Content-Type":"plain/text"},body:o});if(!k.ok)return console.error("Failed to get next message"),null;const D=await k.json();console.log(D);for(var p=[],T=0;T<D.length;(T+=1)-1){const{content:G,role:L}=D[T],{text:V}=G[0],{value:Y}=V;p.push({message:Y,role:L})}return p}catch(k){return console.error("Error getting next message:",k),null}}async function x(){if(n!=null&&confirm("정말 대화를 초기화하시겠습니까?"))try{if(g(f,!0),g(s,"대화 초기화 중..."),g(i,!0),!(await fetch(`http://localhost:8080/assistant/thread/${n}`,{method:"DELETE"})).ok){console.error("Failed to delete thread"),alert("대화 초기화에 실패했습니다. 나중에 다시 시도해 주세요.");return}localStorage.removeItem("threadId"),n=null,g(l,!0),g(c,[])}catch(o){console.error("Error deleting thread:",o)}finally{g(f,!1),g(i,!1)}}ie();var I=Ze();Re(o=>{var p=qe();He.title="Home",Ne(6),O(o,p)});var E=A(I);X(E,()=>b(l),o=>{var p=Ke();O(o,p)});var h=S(E,2);X(h,()=>b(i),o=>{var p=We(),T=A(p,!0);M(p),j(()=>U(T,b(s))),O(o,p)});var _=S(h,2);je(_,5,()=>b(c),o=>o,(o,p)=>{Qe(o,{get message(){return b(p).message},get role(){return b(p).role}})}),M(_);var C=S(_,2),y=A(C);ze(y),ne(y,"placeholder",d);var w=S(y,2),z=S(w,2);M(C),M(I),j(()=>{y.disabled=b(f),w.disabled=b(f),z.disabled=b(f)}),Ve(y,()=>b(a),o=>g(a,o)),Z("click",z,x),Z("submit",C,m),O(r,I),De()}export{ir as component,or as universal};
